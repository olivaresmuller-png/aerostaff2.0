import{c as he,t as ye,a as Ee,b as ne,s as Ze,r as d,S as be,j as e,d as j,C as xs,P as As,f,e as ms,g as hs,h as us,u as Es,i as Bs,k as Xe,l as Ps,m as F,B as k,D as Qe,n as es,o as X,p as ss,q as ts,v as as,I as ns,w as rs,x as R,T as Ls,y as ls,z as Is,U as $s,A as Oe,E as Te}from"./index-CbnIlcx2.js";import{l as Fs,S as Rs,U as is}from"./index.module-BREo-iRM.js";import{S as W,a as K,b as q,c as Q,d as ee,e as N,f as se}from"./select-DmSMcCjy.js";import{T as Vs,a as _s,b as Ae,P as Gs,c as zs,d as Hs,e as ds,f as ge,g as Us,h as je}from"./table-PEmnfhX0.js";import{L as te,B as U}from"./label-DGY_y_Da.js";import{S as cs}from"./scroll-area-zVoU-w09.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],me=he("circle-x",Ws);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],qs=he("coffee",Ks);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],Be=he("graduation-cap",Ys);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Zs=he("heart",Js);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Qs=he("shield",Xs);function fs(n,a){const r=ye(n);if(isNaN(a))return Ee(n,NaN);if(!a)return r;const p=r.getDate(),y=Ee(n,r.getTime());y.setMonth(r.getMonth()+a+1,0);const x=y.getDate();return p>=x?y:(r.setFullYear(y.getFullYear(),y.getMonth(),p),r)}function ps(n,a){const r=a*7;return ne(n,r)}function et(n){return Ee(n,Date.now())}function st(n,a){const r=Ze(n),p=Ze(a);return+r==+p}function tt(n){const a=ye(n),r=a.getMonth();return a.setFullYear(a.getFullYear(),r+1,0),a.setHours(23,59,59,999),a}function at(n){const a=ye(n);return a.setDate(1),a.setHours(0,0,0,0),a}function Pe(n){return ye(n).getDay()}function re(n){return st(n,et(n))}function nt(n,a){return fs(n,-1)}function rt(n,a){return ps(n,-1)}const G=d.memo(function({code:a,size:r="md",showLabel:p=!1}){const y=be.find(t=>t.code===a),x=()=>a==="Ea"||a==="e"?"shift-early":a==="La"||a==="AL"?"shift-late":a==="Ae"||a==="eA"?"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400":a==="V"?"shift-vacation":a==="T"||a==="TD"?"shift-training":a==="S"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"shift-off",b={xs:"text-[8px] px-1 py-0 min-w-[20px]",sm:"text-[10px] px-1.5 py-0.5 min-w-[28px]",md:"text-xs px-2 py-1 min-w-[36px]",lg:"text-sm px-3 py-1.5 min-w-[48px]"};return e.jsxs("span",{"data-testid":`badge-shift-${a}`,className:j("inline-flex items-center justify-center font-mono font-semibold rounded-md transition-colors",x(),b[r]),children:[a,p&&y&&e.jsx("span",{className:"ml-1.5 font-sans font-normal opacity-75",children:y.label})]})}),lt=["Ea","La","M","Ae","AL","e","eA","l","LA","TD","HO","t4"],it=["FT","BT","ET","FD","SI","SE","Sn","TR"],dt=["V","PW","PC","PB","PD","PG","PI","PH","PM","PL","UL","KO","KB","FL"],ct=["S","IC","IW","AC","AW"],ot=["MC","MW"],xt=["-","OFF","T","?"],ae={Ea:"05:00–14:00 • Standard early shift",La:"13:00–22:00 • Standard late shift",M:"09:00–18:00 • Middle/day shift",Ae:"06:00–15:00 • Afternoon-early overlap",AL:"14:00–23:00 • Afternoon-late overlap",e:"05:00–15:30 • Extended early (10h)",eA:"06:00–16:30 • Extended alt early (10h)",l:"12:30–23:00 • Extended late (10h)",LA:"13:30–22:30 • Late alternate",TD:"Part Time Day shift",t4:"4-hour training block",FT:"Swiss public holiday (Feiertag)",BT:"Business Trip",SI:"School internal training",SE:"School external training",Sn:"School night session",V:"Vacation day",PW:"Wedding (own) - 3 Days paid leave",PB:"Birth - 2 Days paid leave",PD:"Death (Spouse/Child/Parents) - 3 Days",UL:"Unpaid Leave",KO:"Kompensation ex Overtime",KB:"Kompensation ex Timebonus",S:"Sick with Certificate",IC:"Sick with Certificate",IW:"Sick without Certificate",IB:"Baby Leave with Certificate",IM:"Baby Leave",IN:"Nurse of close relatives",AC:"Accident with Certificate",AW:"Accident without Certificate",MC:"Military with EO",MW:"Military without EO",FL:"Kompensation ex Flextime",HO:"Home Office",ET:"Educational Trip",FD:"Flight Duty",OF:"Office Duty",PR:"Projects",PC:"Wedding (Child) - 1 Day",PG:"Death (In-Law/Grandp.) - 2 Days",PI:"Death (In-Law/Sibling) - 1 Day",PH:"Moving HB >100km - 2 Days",PM:"Moving - 1 Day",PL:"Paid Leave",PK:"Baby Leave (Mutterschaftsurl)",ST:"Study Time",TO:"Time out",TR:"Training (Instructor) 08:00-17:00","-":"Off day",OFF:"Scheduled off duty",T:"Training day","?":"Unassigned / TBD"},Le=d.memo(function({value:a,onValueChange:r,compact:p,"data-testid":y}){const x=be.find(t=>t.code===a),b=t=>be.filter(M=>t.includes(M.code));return e.jsxs(W,{value:a,onValueChange:t=>r(t),children:[e.jsxs(K,{className:j("gap-2 border-2 hover:border-primary/50 transition-colors",p?"w-auto h-8 px-2":"w-auto"),"data-testid":y,children:[e.jsx(G,{code:a,size:"sm"}),!p&&x&&x.hours>0&&e.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[x.hours,"h"]})]}),e.jsxs(q,{className:"w-[340px] max-h-[450px]",children:[e.jsxs(Q,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-primary font-semibold py-2",children:[e.jsx(xs,{className:"w-4 h-4"}),"Work Shifts"]}),b(lt).map(t=>e.jsx(N,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-primary/5",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(G,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsxs("span",{className:"text-xs text-emerald-600 font-bold bg-emerald-50 px-1.5 py-0.5 rounded ml-2",children:[t.hours,"h"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:ae[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(Q,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-blue-600 font-semibold py-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Training & Business"]}),b(it).map(t=>e.jsx(N,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-blue-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(G,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),t.hours>0&&e.jsxs("span",{className:"text-xs text-blue-600 font-bold bg-blue-50 px-1.5 py-0.5 rounded ml-2",children:[t.hours,"h"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:ae[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(Q,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-amber-600 font-semibold py-2",children:[e.jsx(As,{className:"w-4 h-4"}),"Leave & Time Off"]}),b(dt).map(t=>e.jsx(N,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-amber-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(G,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:ae[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(Q,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-rose-600 font-semibold py-2",children:[e.jsx(Zs,{className:"w-4 h-4"}),"Sick Leave"]}),b(ct).map(t=>e.jsx(N,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-rose-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(G,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:ae[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(Q,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-indigo-600 font-semibold py-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Military Service"]}),b(ot).map(t=>e.jsx(N,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-indigo-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(G,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:ae[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(Q,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-slate-500 font-semibold py-2",children:[e.jsx(qs,{className:"w-4 h-4"}),"Off Duty"]}),b(xt).map(t=>e.jsx(N,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-slate-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(G,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:ae[t.code]})]})]})},t.code))]})]})]})}),mt=d.memo(function({employees:a,weekDates:r,getAssignment:p,onShiftChange:y}){return e.jsxs("div",{className:"min-w-[800px]",children:[e.jsxs("div",{className:"flex border-b border-border bg-muted/20 sticky top-0 z-20",children:[e.jsx("div",{className:"text-left p-3 font-medium text-muted-foreground sticky left-0 bg-card z-10 min-w-[200px] w-[200px] flex-shrink-0",children:"Employee"}),r.map(x=>e.jsxs("div",{className:j("p-3 text-center min-w-[80px] flex-1",re(new Date(x))&&"bg-primary/5"),children:[e.jsx("div",{className:"font-medium",children:f(new Date(x),"EEE")}),e.jsx("div",{className:j("text-sm",re(new Date(x))?"text-primary font-semibold":"text-muted-foreground"),children:f(new Date(x),"d")})]},x))]}),e.jsx("div",{className:"max-h-[calc(100vh-280px)] overflow-y-auto",children:a.map(x=>e.jsxs("div",{className:j("flex border-b border-border/50",x.role==="PM"&&"bg-amber-50 dark:bg-amber-950/30",x.role==="PS"&&"bg-emerald-50 dark:bg-emerald-950/30",x.role==="SrEng"&&"bg-lime-50 dark:bg-lime-950/20"),children:[e.jsx("div",{className:j("p-3 sticky left-0 z-10 border-r border-border/50 min-w-[200px] w-[200px] flex-shrink-0 flex items-center",x.role==="PM"?"bg-amber-50 dark:bg-amber-950/30":x.role==="PS"?"bg-emerald-50 dark:bg-emerald-950/30":x.role==="SrEng"?"bg-lime-50 dark:bg-lime-950/20":"bg-card"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-xs font-mono font-bold text-primary",children:x.initials}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:x.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.department.replace("S/","")})]})]})}),r.map(b=>{const t=p(b,x.id)||"-";return e.jsxs("div",{className:j("p-2 flex-1 flex items-center justify-center min-w-[80px]",re(new Date(b))&&"bg-primary/5"),children:[e.jsx("span",{className:"print-only font-mono text-xs font-medium",children:t}),e.jsx("span",{className:"screen-only",children:e.jsx(Le,{value:t,onValueChange:M=>y(b,x.id,M),compact:!0,"data-testid":`select-shift-${x.id}-${b}`})})]},b)})]},x.id))})]})}),ht=d.memo(function({employees:a,monthDays:r,getAssignment:p,onShiftChange:y}){const[x,b]=d.useState(null);return e.jsxs("div",{className:"min-w-[1200px]",children:[e.jsxs("div",{className:"flex border-b border-border bg-muted/20 sticky top-0 z-20",children:[e.jsx("div",{className:"text-left p-2 font-medium text-muted-foreground sticky left-0 bg-card z-10 min-w-[180px] w-[180px] flex-shrink-0 text-xs",children:"Employee"}),r.map(t=>{const M=f(t,"yyyy-MM-dd"),I=[0,6].includes(Pe(t));return e.jsxs("div",{className:j("p-1 text-center min-w-[32px] flex-1 text-xs",I&&"bg-muted/50",re(t)&&"bg-primary/10"),children:[e.jsx("div",{className:"font-medium",children:f(t,"EEE")[0]}),e.jsx("div",{className:j("text-[10px]",re(t)?"text-primary font-bold":"text-muted-foreground"),children:f(t,"d")})]},M)})]}),e.jsx("div",{className:"max-h-[calc(100vh-280px)] overflow-y-auto",children:a.map(t=>e.jsxs("div",{className:j("flex border-b border-border/50",t.role==="PM"&&"bg-amber-50/50",t.role==="PS"&&"bg-emerald-50/50",t.role==="SrEng"&&"bg-lime-50/50"),children:[e.jsx("div",{className:j("p-2 sticky left-0 z-10 border-r border-border/50 text-xs min-w-[180px] w-[180px] flex-shrink-0 flex items-center",t.role==="PM"?"bg-amber-50":t.role==="PS"?"bg-emerald-50":t.role==="SrEng"?"bg-lime-50":"bg-card"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-primary text-[10px]",children:t.initials}),e.jsx("span",{className:"font-medium truncate max-w-[120px]",children:t.name.split(",")[0]})]})}),r.map(M=>{const I=f(M,"yyyy-MM-dd"),_=p(I,t.id)||"-",Ne=[0,6].includes(Pe(M)),E=`${t.id}-${I}`;return e.jsxs("div",{className:j("p-0.5 flex-1 flex items-center justify-center min-w-[32px]",Ne&&"bg-muted/30",re(M)&&"bg-primary/5"),children:[e.jsx("span",{className:"print-only font-mono text-[9px] font-medium",children:_}),e.jsx("span",{className:"screen-only",children:e.jsxs(ms,{open:x===E,onOpenChange:le=>b(le?E:null),children:[e.jsx(hs,{asChild:!0,children:e.jsx("button",{className:"cursor-pointer hover:scale-110 transition-transform",children:e.jsx(G,{code:_,size:"xs"})})}),e.jsx(us,{className:"w-48 p-2",align:"center",children:e.jsx(Le,{value:_,onValueChange:le=>{y(I,t.id,le),b(null)},"data-testid":`select-shift-month-${t.id}-${I}`})})]})})]},I)})]},t.id))})]})}),os=200,V=250,P=6,L=2;function vt(){const{employees:n,assignments:a,selectedDate:r,setSelectedDate:p,updateAssignment:y,getAssignment:x,getWeekDates:b,importMetadata:t}=Es(),[M,I]=d.useState("week"),[_,Ne]=d.useState("all"),[E,le]=d.useState(r),[ut,ft]=d.useState(!1),[Ie,$e]=d.useState(""),[ve]=Fs(Ie,150),[z,Fe]=d.useState(null),[D,Re]=d.useState(1),[ie,gs]=d.useState("V"),[Y,js]=d.useState(r),[ue,bs]=d.useState(7),[ys,Ve]=d.useState(!1);f(E,"yyyy-MM-dd");const Ns=[{code:"V",label:"Vacation (V)"},{code:"-",label:"Day Off (-)"},{code:"S",label:"Sick (S)"},{code:"KO",label:"Komp. Overtime (KO)"},{code:"FL",label:"Komp. Flextime (FL)"},{code:"UL",label:"Unpaid Leave (UL)"},{code:"MC",label:"Military (MC)"},{code:"TR",label:"Training (TR)"}],vs=s=>{z&&y(s,z,ie)},Ss=()=>{!z||!m.results||m.results.forEach(s=>{s.result.canGrant&&y(s.dateStr,z,ie)})},_e=d.useMemo(()=>{if(!ve.trim())return[];const s=ve.toLowerCase().trim();return n.filter(i=>i.name.toLowerCase().includes(s)||i.initials.toLowerCase().includes(s)).slice(0,8)},[n,ve]),S=d.useMemo(()=>z?n.find(s=>s.id===z):null,[n,z]),Se=d.useMemo(()=>{const s=["THRU","MELM","YCCR","TIMJ","HUAB","YYRJ","MECU","LECN","LCLE","HUDM","ARUZ","KRZE","LSIE","AAUL","WINY","SOER","ERIZ","BHAE","DALL","GBRU","LUPR","RREN","GNET","TOKR","COSM","FILM","PAAO","LUCP","MF","NATS","MZIM","TIML","OLCR","WEZE","JAWE","KRAF","RUAC","SAEF","LABB","RDAR","ARNG","MCOS","THNA","JUTI","GERO","MURB","BOGO","EGGL","RULO","RPAS","DMIA","ENRL","ATET_1","BOEO","DEOM","PKRI"];return[..._==="all"?n:n.filter(c=>c.department===_)].sort((c,v)=>{const O=s.indexOf(c.initials),T=s.indexOf(v.initials);return O===-1&&T===-1?0:O===-1?1:T===-1?-1:O-T})},[n,_]),de=d.useMemo(()=>b(r),[r,b]),Ge=d.useMemo(()=>{const s=at(r),i=tt(r);return Bs({start:s,end:i})},[r]),J=f(r,"yyyy-MM-dd"),ze=d.useMemo(()=>Xe(n,a,J),[n,a,J]);d.useMemo(()=>Ps(n,a,de),[n,a,de]);const ce=d.useMemo(()=>{const s=J,i=a.filter(C=>C.date===s),c=i.filter(C=>F(C.shiftCode)).length,v=i.filter(C=>["Ea","e","Ae"].includes(C.shiftCode)).length,O=i.filter(C=>["La","l","LA","AL"].includes(C.shiftCode)).length,T=i.filter(C=>!F(C.shiftCode)).length;return{onDuty:c,earlyShifts:v,lateShifts:O,offDuty:T}},[a,J]),we=[{code:"TR",label:"Training",color:"bg-purple-500"},{code:"SI",label:"School Internal",color:"bg-blue-500"},{code:"SE",label:"School External",color:"bg-indigo-500"},{code:"Sn",label:"School Night",color:"bg-violet-500"},{code:"ET",label:"Educational Trip",color:"bg-cyan-500"},{code:"T",label:"Training (Off)",color:"bg-purple-400"}],He=d.useMemo(()=>{const s=[];for(let i=0;i<ue;i++)s.push(f(ne(Y,i),"yyyy-MM-dd"));return s},[Y,ue]),Z=d.useMemo(()=>{const s=we.map(v=>v.code);return a.filter(v=>He.includes(v.date)&&s.includes(v.shiftCode)).map(v=>{const O=n.find(C=>C.id===v.employeeId),T=we.find(C=>C.code===v.shiftCode);return O?{...O,educationType:v.shiftCode,educationLabel:T?.label,educationColor:T?.color,educationDate:v.date}:null}).filter(Boolean)},[a,n,He]),$=s=>{const i=s.skills.map(c=>c.license).filter(Boolean);return i.includes("B1/2")?"B1-2":i.includes("B1")?"B1":i.includes("B2")?"B2":i.includes("A")?"Cat A":i.includes("C")?"C":"None"},m=d.useMemo(()=>{const s=[];for(let h=0;h<D;h++)s.push(f(ne(E,h),"yyyy-MM-dd"));const i=h=>{const l=a.filter(o=>o.date===h),u=Xe(n,a,h),A=l.filter(o=>F(o.shiftCode)).length,Me=l.filter(o=>!F(o.shiftCode)).length,ke=l.filter(o=>o.shiftCode==="V").length,oe=l.filter(o=>["S","IW","IC","AC","AW"].includes(o.shiftCode)).length,H=l.filter(o=>n.find(B=>B.id===o.employeeId)?.role==="SrEng"&&F(o.shiftCode)).length,g=l.filter(o=>n.find(B=>B.id===o.employeeId)?.role==="PS"&&F(o.shiftCode)).length,De=l.filter(o=>{const w=n.find(xe=>xe.id===o.employeeId);if(!w)return!1;const B=$(w);return(B==="B1"||B==="B1-2")&&F(o.shiftCode)}),Cs=l.filter(o=>{const w=n.find(xe=>xe.id===o.employeeId);if(!w)return!1;const B=$(w);return(B==="B2"||B==="B1-2")&&F(o.shiftCode)}),Ms=l.filter(o=>{const w=n.find(xe=>xe.id===o.employeeId);return w?$(w)==="Cat A"&&F(o.shiftCode):!1}),qe=n.filter(o=>{const w=$(o);return w==="B1"||w==="B1-2"}).length,Ye=n.filter(o=>{const w=$(o);return w==="B2"||w==="B1-2"}).length,Je=n.filter(o=>$(o)==="Cat A").length;let fe=0;n.forEach(o=>{o.role!=="PM"&&o.role!=="PS"&&(fe+=8*(o.grade/100))});const pe=fe>0?V/fe:1,ks=Math.ceil(qe*pe),Ds=Math.ceil(Ye*pe),Os=Math.ceil(Je*pe),Ts=[0,6].includes(Pe(new Date(h)));return{dateStr:h,currentManhours:u,onDutyCount:A,offDutyCount:Me,vacationCount:ke,sickCount:oe,seOnDuty:H,psOnDuty:g,b1OnDuty:De.length,b2OnDuty:Cs.length,catAOnDuty:Ms.length,totalB1:qe,totalB2:Ye,totalCatA:Je,minB1Required:ks,minB2Required:Ds,minCatARequired:Os,totalPotentialManhours:fe,requiredPercentage:pe,isWeekend:Ts}},c=s.map(i),v=(h,l)=>{const u=[];let A=!0;if(l.isWeekend&&u.push({type:"yes",text:"Weekend - reduced staffing requirements"}),h){const Me=h.grade===0;if(h.role==="PS"){const g=l.psOnDuty-1;g>=L?u.push({type:"yes",text:`PS coverage OK: ${g} PS remain after granting (min ${L})`}):(u.push({type:"no",text:`PS coverage insufficient: only ${g} PS after granting (need ${L})`}),A=!1)}if(h.role==="SrEng"){const g=l.seOnDuty-1;g>=P?u.push({type:"yes",text:`SE coverage OK: ${g} SE remain after granting (min ${P})`}):(u.push({type:"no",text:`SE coverage insufficient: only ${g} SE after granting (need ${P})`}),A=!1)}const ke=8*(h.grade/100),oe=l.currentManhours-ke;Me?u.push({type:"yes",text:`${h.initials} has 0% grade - no manhours impact`}):oe>=V?u.push({type:"yes",text:`Manhours OK: ${oe.toFixed(1)}h after granting (min ${V}h)`}):(u.push({type:"no",text:`Manhours insufficient: ${oe.toFixed(1)}h after granting (need ${V}h)`}),A=!1);const H=$(h);if(H==="B1"||H==="B1-2"){const g=l.b1OnDuty-1;g>=l.minB1Required?u.push({type:"yes",text:`B1 coverage OK: ${g} on duty after granting (min ${l.minB1Required})`}):(u.push({type:"no",text:`B1 coverage low: ${g} after granting (min ${l.minB1Required})`}),A=!1)}if(H==="B2"||H==="B1-2"){const g=l.b2OnDuty-1;g>=l.minB2Required?u.push({type:"yes",text:`B2 coverage OK: ${g} on duty after granting (min ${l.minB2Required})`}):(u.push({type:"no",text:`B2 coverage low: ${g} after granting (min ${l.minB2Required})`}),A=!1)}if(H==="Cat A"){const g=l.catAOnDuty-1,De=h.grade<=50?.5:1;g>=l.minCatARequired?u.push({type:"yes",text:`Cat A coverage OK: ${g} on duty after granting (min ${l.minCatARequired})`}):u.push({type:"info",text:`Cat A at ${g} after granting (min ${l.minCatARequired}), grade ${h.grade}% = ${De*100}% factor`})}}else l.currentManhours>=V?u.push({type:"yes",text:`Current manhours: ${l.currentManhours.toFixed(1)}h (min ${V}h)`}):(u.push({type:"no",text:`Current manhours: ${l.currentManhours.toFixed(1)}h (need ${V}h)`}),A=!1),l.seOnDuty>=P?u.push({type:"yes",text:`SE on duty: ${l.seOnDuty} (min ${P})`}):(u.push({type:"no",text:`SE on duty: ${l.seOnDuty} (need ${P})`}),A=!1),l.psOnDuty>=L?u.push({type:"yes",text:`PS on duty: ${l.psOnDuty} (min ${L})`}):(u.push({type:"no",text:`PS on duty: ${l.psOnDuty} (need ${L})`}),A=!1),u.push({type:"info",text:`B1: ${l.b1OnDuty}/${l.minB1Required} min | B2: ${l.b2OnDuty}/${l.minB2Required} min | Cat A: ${l.catAOnDuty}/${l.minCatARequired} min`});return{canGrant:A,reasons:u,empSpecific:!!h}},O=c.map(h=>({...h,result:v(S??null,h)})),T=O.every(h=>h.result.canGrant),C=Math.max(0,(c[0]?.seOnDuty||0)-P),ws=Math.max(0,(c[0]?.psOnDuty||0)-L);return{canGrant:T,results:O,message:T?D>1?`OFF DAY CAN BE GRANTED (${D} days)`:"OFF DAY CAN BE GRANTED":"OFF DAY CANNOT BE GRANTED",stats:c[0]||{},positionVacation:{seCanTake:C,psCanTake:ws,seOnDuty:c[0]?.seOnDuty||0,psOnDuty:c[0]?.psOnDuty||0}}},[E,D,a,n,S]),Ue=d.useCallback(s=>{d.startTransition(()=>{p(ne(r,s==="prev"?-1:1))})},[r,p]),We=d.useCallback(s=>{d.startTransition(()=>{p(s==="prev"?rt(r):ps(r,1))})},[r,p]),Ke=d.useCallback(s=>{d.startTransition(()=>{p(s==="prev"?nt(r):fs(r,1))})},[r,p]),Ce=d.useCallback((s,i,c)=>{y(s,i,c)},[y]);return e.jsxs("div",{className:"p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-display font-bold tracking-tight",children:"Schedule"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage daily shift assignments for TMBA teams"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(Vs,{value:M,onValueChange:s=>I(s),children:e.jsxs(_s,{children:[e.jsx(Ae,{value:"day","data-testid":"tab-day-view",children:"Day"}),e.jsx(Ae,{value:"week","data-testid":"tab-week-view",children:"Week"}),e.jsx(Ae,{value:"month","data-testid":"tab-month-view",children:"Month"})]})}),e.jsxs(k,{variant:"outline",className:"gap-2",onClick:()=>window.print(),"data-testid":"button-print",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Print / PDF"]}),e.jsxs(Qe,{children:[e.jsx(es,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:"gap-2","data-testid":"button-check-off-day",children:[e.jsx(X,{className:"w-4 h-4"}),"Check Off Day"]})}),e.jsxs(ss,{className:"max-w-5xl max-h-[90vh] p-0",children:[e.jsx(ts,{className:"px-6 pt-6 pb-4 border-b",children:e.jsx(as,{className:"text-xl",children:"Off Day Availability Check"})}),e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-[340px] border-b lg:border-b-0 lg:border-r p-4 bg-muted/30 space-y-4",children:[e.jsxs("div",{children:[e.jsx(te,{className:"text-sm font-medium mb-2 block",children:"Search Employee (name or code)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Rs,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx(ns,{placeholder:"e.g. THRU or Thurner",value:Ie,onChange:s=>$e(s.target.value),className:"pl-9","data-testid":"input-employee-search"})]}),_e.length>0&&e.jsx("div",{className:"mt-2 border rounded-md bg-background max-h-48 overflow-y-auto",children:_e.map(s=>e.jsxs("button",{onClick:()=>{Fe(s.id),$e("")},className:"w-full px-3 py-2 text-left hover:bg-muted flex items-center gap-2 text-sm","data-testid":`employee-option-${s.initials}`,children:[e.jsx(is,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.initials}),e.jsx("span",{className:"text-muted-foreground",children:s.name}),e.jsx(U,{variant:"outline",className:"ml-auto text-xs",children:$(s)})]},s.id))}),S&&e.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-primary/10 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:S.initials}),e.jsx("p",{className:"text-xs text-muted-foreground",children:S.name})]})]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>Fe(null),className:"h-6 px-2",children:"Clear"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[e.jsx(U,{variant:"secondary",children:$(S)}),e.jsx(U,{variant:"outline",children:S.role}),e.jsxs(U,{variant:"outline",children:[S.grade,"% grade"]})]})]})]}),e.jsxs("div",{children:[e.jsx(te,{className:"text-sm font-medium mb-2 block",children:"Days to Check"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{value:D.toString(),onValueChange:s=>Re(parseInt(s)),children:[e.jsx(K,{className:"w-24","data-testid":"select-days-to-check",children:e.jsx(se,{})}),e.jsx(q,{children:[1,2,3,4,5,6,7,8,9,10].map(s=>e.jsxs(N,{value:s.toString(),children:[s," day",s>1?"s":""]},s))})]}),e.jsx("div",{className:"flex-1",children:e.jsx(ns,{type:"number",min:"1",max:"365",value:D,onChange:s=>Re(Math.max(1,Math.min(365,parseInt(s.target.value)||1))),placeholder:"Custom",className:"w-full","data-testid":"input-days-custom"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:D===1?"Single day":`${D} consecutive days`})]}),e.jsxs("div",{children:[e.jsx(te,{className:"text-sm font-medium mb-2 block",children:"Start Date"}),e.jsx(rs,{mode:"single",selected:E,onSelect:s=>s&&le(s),weekStartsOn:1,className:"rounded-md border mx-auto","data-testid":"calendar-off-day-date"})]}),e.jsxs("div",{className:"text-center p-2 bg-background rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Checking:"}),e.jsxs("p",{className:"text-sm font-bold",children:[f(E,"MMM d"),D>1&&` - ${f(ne(E,D-1),"MMM d, yyyy")}`,D===1&&`, ${f(E,"yyyy")}`]})]}),S&&e.jsxs("div",{children:[e.jsx(te,{className:"text-sm font-medium mb-2 block",children:"Off Day Type"}),e.jsxs(W,{value:ie,onValueChange:s=>gs(s),children:[e.jsx(K,{"data-testid":"select-off-day-type",children:e.jsx(se,{})}),e.jsx(q,{children:Ns.map(s=>e.jsx(N,{value:s.code,children:s.label},s.code))})]})]})]}),e.jsx(cs,{className:"flex-1 max-h-[60vh] lg:max-h-[70vh]",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs(R,{className:j("p-4",m.canGrant?"bg-green-50 border-green-200 dark:bg-green-950/30 dark:border-green-800":"bg-red-50 border-red-200 dark:bg-red-950/30 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.canGrant?e.jsx(X,{className:"w-8 h-8 text-green-600"}):e.jsx(me,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("span",{className:j("font-bold text-lg block",m.canGrant?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:m.message}),S&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["for ",S.initials," (",S.name,")"]})]})]}),m.positionVacation&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Position Availability:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[(()=>{const s=S?.role==="SrEng",i=s?m.positionVacation.seOnDuty-1:m.positionVacation.seOnDuty,c=s?i>=P:m.positionVacation.seCanTake>0;return e.jsxs("div",{className:j("rounded-lg p-3 border",c?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"SE"}),c?e.jsx(X,{className:"w-5 h-5 text-green-600"}):e.jsx(me,{className:"w-5 h-5 text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:m.positionVacation.seCanTake}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"can take off"}),e.jsxs("div",{className:"text-xs mt-1",children:["(",m.positionVacation.seOnDuty," on duty, min ",P,")"]})]})})(),(()=>{const s=S?.role==="PS",i=s?m.positionVacation.psOnDuty-1:m.positionVacation.psOnDuty,c=s?i>=L:m.positionVacation.psCanTake>0;return e.jsxs("div",{className:j("rounded-lg p-3 border",c?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"PS"}),c?e.jsx(X,{className:"w-5 h-5 text-green-600"}):e.jsx(me,{className:"w-5 h-5 text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:m.positionVacation.psCanTake}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"can take off"}),e.jsxs("div",{className:"text-xs mt-1",children:["(",m.positionVacation.psOnDuty," on duty, min ",L,")"]})]})})()]})]}),m.stats&&e.jsxs("div",{className:"grid grid-cols-5 gap-2 mb-4 text-sm",children:[e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:m.stats.currentManhours?.toFixed(0)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Manhours"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:m.stats.b1OnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"B1"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:m.stats.b2OnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"B2"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:m.stats.catAOnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Cat A"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:m.stats.sickCount||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Sick"})]})]})]}),m.results?.map((s,i)=>e.jsxs(R,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.result.canGrant?e.jsx(X,{className:"w-5 h-5 text-green-600"}):e.jsx(me,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-semibold",children:f(new Date(s.dateStr),"EEE, MMM d")}),e.jsx(U,{variant:s.result.canGrant?"default":"destructive",children:s.result.canGrant?"OK":"NO"}),S&&s.result.canGrant&&e.jsxs(k,{size:"sm",className:"ml-auto",onClick:()=>vs(s.dateStr),"data-testid":`apply-off-day-${i}`,children:["Apply ",ie]})]}),e.jsx("div",{className:"space-y-1",children:s.result.reasons.map((c,v)=>e.jsxs("div",{className:j("flex items-start gap-2 text-sm p-2 rounded",c.type==="yes"?"bg-green-100/50 dark:bg-green-900/20":c.type==="no"?"bg-red-100/50 dark:bg-red-900/20":"bg-blue-100/50 dark:bg-blue-900/20"),children:[c.type==="yes"?e.jsx(X,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}):c.type==="no"?e.jsx(me,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}):e.jsx(Ls,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:c.type==="yes"?"text-green-700 dark:text-green-400":c.type==="no"?"text-red-700 dark:text-red-400":"text-blue-700 dark:text-blue-400",children:c.text})]},v))})]},i)),S&&m.canGrant&&m.results&&m.results.length>1&&e.jsxs(k,{className:"w-full",onClick:Ss,"data-testid":"apply-all-off-days",children:["Apply ",ie," to All ",m.results.filter(s=>s.result.canGrant).length," Approved Days"]}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/50 p-3 rounded",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Off Day Rules:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-0.5",children:[e.jsxs("li",{children:["Minimum ",V," manhours must remain"]}),e.jsxs("li",{children:["Minimum ",P," SE must remain on duty"]}),e.jsxs("li",{children:["Minimum ",L," PS must remain on duty"]}),e.jsxs("li",{children:["B1/B2/Cat A coverage based on % of ",V,"h vs total potential"]}),e.jsx("li",{children:"Grade 0% employees can always take off"}),e.jsx("li",{children:"B1-2 license counts toward both B1 and B2"})]})]})]})})]})]})]}),e.jsxs(Qe,{children:[e.jsx(es,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"gap-2","data-testid":"button-training-view",children:[e.jsx(Be,{className:"w-4 h-4"}),"Education",Z.length>0&&e.jsx(U,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:Z.length})]})}),e.jsxs(ss,{className:"max-w-2xl max-h-[85vh] p-0",children:[e.jsx(ts,{className:"px-6 pt-6 pb-4 border-b",children:e.jsxs(as,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Training & Education Overview"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(te,{className:"text-xs",children:"Start Date"}),e.jsxs(ms,{open:ys,onOpenChange:Ve,children:[e.jsx(hs,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"w-[160px] justify-start text-left font-normal",children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),f(Y,"MMM d, yyyy")]})}),e.jsx(us,{className:"w-auto p-0",align:"start",children:e.jsx(rs,{mode:"single",selected:Y,onSelect:s=>{s&&(js(s),Ve(!1))},weekStartsOn:1,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(te,{className:"text-xs",children:"Period"}),e.jsxs(W,{value:String(ue),onValueChange:s=>bs(Number(s)),children:[e.jsx(K,{className:"w-[120px]",children:e.jsx(se,{})}),e.jsxs(q,{children:[e.jsx(N,{value:"1",children:"1 day"}),e.jsx(N,{value:"7",children:"7 days"}),e.jsx(N,{value:"14",children:"14 days"}),e.jsx(N,{value:"30",children:"30 days"})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[f(Y,"MMM d")," - ",f(ne(Y,ue-1),"MMM d, yyyy")]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:we.map(s=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs px-2 py-1 bg-muted rounded",children:[e.jsx("span",{className:j("w-2.5 h-2.5 rounded-full",s.color)}),e.jsx("span",{className:"font-medium",children:s.code}),e.jsxs("span",{className:"text-muted-foreground",children:["- ",s.label]})]},s.code))}),Z.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No employees in training/school during this period"}):e.jsx(cs,{className:"h-[350px] border rounded-lg",children:e.jsxs(zs,{children:[e.jsx(Hs,{children:e.jsxs(ds,{children:[e.jsx(ge,{children:"Employee"}),e.jsx(ge,{children:"Department"}),e.jsx(ge,{children:"Date"}),e.jsx(ge,{children:"Type"})]})}),e.jsx(Us,{children:Z.map((s,i)=>e.jsxs(ds,{children:[e.jsx(je,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center text-xs font-bold",children:s.initials}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(je,{className:"text-muted-foreground",children:s.department.replace("S/","")}),e.jsx(je,{children:f(new Date(s.educationDate),"EEE, MMM d")}),e.jsx(je,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:j("w-2 h-2 rounded-full",s.educationColor)}),e.jsx(U,{variant:"outline",className:"text-xs",children:s.educationType})]})})]},`${s.id}-${s.educationDate}-${i}`))})]})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground pt-2 border-t",children:[e.jsxs("span",{children:["Total: ",Z.length," education entries"]}),e.jsxs("span",{children:[new Set(Z.map(s=>s.id)).size," unique employees"]})]})]})]})]}),e.jsxs(W,{value:_,onValueChange:Ne,children:[e.jsx(K,{className:"w-[140px]","data-testid":"select-department-filter",children:e.jsx(se,{placeholder:"Department"})}),e.jsxs(q,{children:[e.jsx(N,{value:"all",children:"All Teams"}),e.jsx(N,{value:"S/TMBA",children:"TMBA"}),e.jsx(N,{value:"S/TMBAA",children:"TMBAA"}),e.jsx(N,{value:"S/TMBAB",children:"TMBAB"}),e.jsx(N,{value:"S/TMBAC",children:"TMBAC"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(R,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(xs,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Daily Hours"}),e.jsx("p",{className:j("text-xl font-display font-bold",ze<os?"text-red-500":"text-green-500"),children:ze.toFixed(1)})]})]})}),e.jsx(R,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-success/10 flex items-center justify-center",children:e.jsx(Is,{className:"w-5 h-5 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Daily Target"}),e.jsxs("p",{className:"text-xl font-display font-bold",children:[os,"h"]})]})]})}),e.jsx(R,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-warning/10 flex items-center justify-center",children:e.jsx($s,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"On Duty"}),e.jsx("p",{className:"text-xl font-display font-bold",children:ce.onDuty})]})]})}),e.jsx(R,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-accent flex items-center justify-center",children:e.jsx(ls,{className:"w-5 h-5 text-accent-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Off Duty"}),e.jsx("p",{className:"text-xl font-display font-bold",children:ce.offDuty})]})]})})]}),t&&e.jsxs("div",{className:"flex items-center gap-4 px-3 py-2 bg-muted/50 rounded-lg text-xs text-muted-foreground border","data-testid":"import-metadata-info",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Data Source:"}),e.jsxs("span",{children:["Imported ",f(new Date(t.importedAt),"MMM d, yyyy HH:mm")]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[t.employeeCount," employees"]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[t.assignmentCount.toLocaleString()," assignments"]}),t.dateRange&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:["Range: ",f(new Date(t.dateRange.start),"MMM d")," - ",f(new Date(t.dateRange.end),"MMM d, yyyy")]})]})]}),M==="day"&&e.jsxs(R,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>Ue("prev"),"data-testid":"button-prev-day",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"font-display font-semibold text-lg",children:f(r,"EEEE, MMMM d, yyyy")}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Early: ",ce.earlyShifts]}),e.jsxs("span",{children:["Late: ",ce.lateShifts]}),e.jsxs("span",{children:["Off: ",ce.offDuty]})]})]}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>Ue("next"),"data-testid":"button-next-day",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Se.map(s=>{const i=x(J,s.id)||"-";return be.find(c=>c.code===i),e.jsxs("div",{className:j("p-3 rounded-lg border flex items-center justify-between",s.role==="PM"&&"bg-amber-50 border-amber-200",s.role==="PS"&&"bg-emerald-50 border-emerald-200",s.role==="SrEng"&&"bg-lime-50 border-lime-200",!["PM","PS","SrEng"].includes(s.role)&&"bg-card border-border"),"data-testid":`employee-card-${s.id}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-xs font-mono font-bold text-primary",children:s.initials}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.role," • ",s.department.replace("S/","")]})]})]}),e.jsx(Le,{value:i,onValueChange:c=>Ce(J,s.id,c),"data-testid":`select-shift-day-${s.id}`})]},s.id)})})})]}),M==="week"&&e.jsxs(R,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>We("prev"),"data-testid":"button-prev-week",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"text-center",children:e.jsxs("h2",{className:"font-display font-semibold text-lg",children:[f(new Date(de[0]),"MMM d")," - ",f(new Date(de[6]),"MMM d, yyyy")]})}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>We("next"),"data-testid":"button-next-week",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(mt,{employees:Se,weekDates:de,getAssignment:x,onShiftChange:Ce})})]}),M==="month"&&e.jsxs(R,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>Ke("prev"),"data-testid":"button-prev-month",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{value:String(r.getMonth()),onValueChange:s=>{d.startTransition(()=>{p(new Date(r.getFullYear(),parseInt(s),1))})},children:[e.jsx(K,{className:"w-[130px]","data-testid":"select-month",children:e.jsx(se,{})}),e.jsx(q,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((s,i)=>e.jsx(N,{value:String(i),children:s},i))})]}),e.jsxs(W,{value:String(r.getFullYear()),onValueChange:s=>{d.startTransition(()=>{p(new Date(parseInt(s),r.getMonth(),1))})},children:[e.jsx(K,{className:"w-[90px]","data-testid":"select-year",children:e.jsx(se,{})}),e.jsx(q,{children:[2024,2025,2026,2027,2028].map(s=>e.jsx(N,{value:String(s),children:s},s))})]})]}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>Ke("next"),"data-testid":"button-next-month",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-x-auto",children:Ge.length>0&&e.jsx(ht,{employees:Se,monthDays:Ge,getAssignment:x,onShiftChange:Ce})})]})]})}export{vt as CalendarPage};
